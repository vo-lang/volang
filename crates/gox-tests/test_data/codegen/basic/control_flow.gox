// +vm
// Test: control flow (loops)
package main

func main() {
    // Sum 1 to 10 = 55
    sum := 0
    for i := 1; i <= 10; i++ {
        sum = sum + i
    }
    assert(sum == 55, "sum of 1 to 10 should be 55")
    
    // While-style loop
    count := 0
    for count < 5 {
        count = count + 1
    }
    assert(count == 5, "count should be 5")
    
    // Break
    breakVal := 0
    for i := 0; i < 100; i++ {
        if i == 7 {
            break
        }
        breakVal = i
    }
    assert(breakVal == 6, "breakVal should be 6")
    
    // Continue
    skipSum := 0
    for i := 0; i < 5; i++ {
        if i == 2 {
            continue
        }
        skipSum = skipSum + i
    }
    assert(skipSum == 8, "skipSum should be 8 (0+1+3+4)")
}

=== codegen ===
module main

const 0 string "sum of 1 to 10 should be 55"
const 1 string "count should be 5"
const 2 string "breakVal should be 6"
const 3 string "skipSum should be 8 (0+1+3+4)"

func main
  locals 26
  0: LoadInt r1, 0
  1: Mov r0, r1
  2: LoadInt r3, 1
  3: Mov r2, r3
  4: LoadInt r4, 10
  5: LeI64 r5, r2, r4
  6: JumpIfNot r5, 6
  7: AddI64 r6, r0, r2
  8: Mov r0, r6
  9: LoadInt r6, 1
  10: AddI64 r2, r2, r6
  11: Jump -7
  12: LoadInt r6, 55
  13: EqI64 r7, r0, r6
  14: LoadConst r8, $0
  15: AssertBegin r7, 1, 172
  16: AssertArg r8, 14
  17: AssertEnd
  18: LoadNil r9
  19: LoadInt r7, 0
  20: Mov r6, r7
  21: LoadInt r8, 5
  22: LtI64 r9, r6, r8
  23: JumpIfNot r9, 5
  24: LoadInt r10, 1
  25: AddI64 r11, r6, r10
  26: Mov r6, r11
  27: Jump -6
  28: LoadInt r10, 5
  29: EqI64 r11, r6, r10
  30: LoadConst r12, $1
  31: AssertBegin r11, 1, 321
  32: AssertArg r12, 14
  33: AssertEnd
  34: LoadNil r13
  35: LoadInt r11, 0
  36: Mov r10, r11
  37: LoadInt r13, 0
  38: Mov r12, r13
  39: LoadInt r14, 100
  40: LtI64 r15, r12, r14
  41: JumpIfNot r15, 9
  42: LoadInt r16, 7
  43: EqI64 r17, r12, r16
  44: JumpIfNot r17, 2
  45: Jump 5
  46: Mov r10, r12
  47: LoadInt r16, 1
  48: AddI64 r12, r12, r16
  49: Jump -10
  50: LoadInt r16, 6
  51: EqI64 r17, r10, r16
  52: LoadConst r18, $2
  53: AssertBegin r17, 1, 507
  54: AssertArg r18, 14
  55: AssertEnd
  56: LoadNil r19
  57: LoadInt r17, 0
  58: Mov r16, r17
  59: LoadInt r19, 0
  60: Mov r18, r19
  61: LoadInt r20, 5
  62: LtI64 r21, r18, r20
  63: JumpIfNot r21, 10
  64: LoadInt r22, 2
  65: EqI64 r23, r18, r22
  66: JumpIfNot r23, 2
  67: Jump 3
  68: AddI64 r24, r16, r18
  69: Mov r16, r24
  70: LoadInt r22, 1
  71: AddI64 r18, r18, r22
  72: Jump -11
  73: LoadInt r22, 8
  74: EqI64 r23, r16, r22
  75: LoadConst r24, $3
  76: AssertBegin r23, 1, 711
  77: AssertArg r24, 14
  78: AssertEnd
  79: LoadNil r25
  80: Return r0, 0
end

func $init
  locals 0
  0: Return r0, 0
end

func $entry
  locals 0
  0: Call 1, r0, 0, 0
  1: Call 0, r0, 0, 0
  2: Return r0, 0
end

entry $entry
