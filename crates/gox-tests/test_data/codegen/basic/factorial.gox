// Test: recursive factorial
package main

func factorial(n int) int {
    if n <= 1 {
        return 1
    }
    return n * factorial(n-1)
}

func main() {
    assert(factorial(0) == 1, "factorial(0) should be 1")
    assert(factorial(1) == 1, "factorial(1) should be 1")
    assert(factorial(5) == 120, "factorial(5) should be 120")
    assert(factorial(6) == 720, "factorial(6) should be 720")
}

=== codegen ===
module main

const 0 string "factorial(0) should be 1"
const 1 string "factorial(1) should be 1"
const 2 string "factorial(5) should be 120"
const 3 string "factorial(6) should be 720"

func factorial
  params 1 1
  locals 6
  returns 1
  0: LoadInt r1, 1
  1: LeI64 r2, r0, r1
  2: JumpIfNot r2, 3
  3: LoadInt r3, 1
  4: Return r3, 1
  5: LoadInt r3, 1
  6: SubI64 r4, r0, r3
  7: Mov r3, r4
  8: Call 0, r3, 1, 1
  9: MulI64 r5, r0, r3
  10: Mov r3, r5
  11: Return r3, 1
end

func main
  locals 5
  0: LoadInt r0, 0
  1: Call 0, r0, 1, 1
  2: LoadInt r1, 1
  3: EqI64 r2, r0, r1
  4: LoadConst r3, $0
  5: AssertBegin r2, 1, 168
  6: AssertArg r3, 14
  7: AssertEnd
  8: LoadNil r4
  9: LoadInt r0, 1
  10: Call 0, r0, 1, 1
  11: LoadInt r1, 1
  12: EqI64 r2, r0, r1
  13: LoadConst r3, $1
  14: AssertBegin r2, 1, 226
  15: AssertArg r3, 14
  16: AssertEnd
  17: LoadNil r4
  18: LoadInt r0, 5
  19: Call 0, r0, 1, 1
  20: LoadInt r1, 120
  21: EqI64 r2, r0, r1
  22: LoadConst r3, $2
  23: AssertBegin r2, 1, 284
  24: AssertArg r3, 14
  25: AssertEnd
  26: LoadNil r4
  27: LoadInt r0, 6
  28: Call 0, r0, 1, 1
  29: LoadInt r1, 720
  30: EqI64 r2, r0, r1
  31: LoadConst r3, $3
  32: AssertBegin r2, 1, 346
  33: AssertArg r3, 14
  34: AssertEnd
  35: LoadNil r4
  36: Return r0, 0
end

func $init
  locals 0
  0: Return r0, 0
end

func $entry
  locals 0
  0: Call 2, r0, 0, 0
  1: Call 1, r0, 0, 0
  2: Return r0, 0
end

entry $entry
