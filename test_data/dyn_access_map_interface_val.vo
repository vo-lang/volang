// Test dynamic access on map with interface values
// Bug #2: dyn_get_index returns interface value with wrong itab for any

import "errors"

func main() {
    // Create a map with error values
    m := map[string]error{
        "a": errors.New("err_a"),
        "b": errors.New("err_b"),
    }
    
    // Cast to any
    var a any = m
    
    // Dynamic index access
    v, err := a~>["a"]
    assert(err == nil, "unexpected error")

    // Dynamic field access (equivalent to a~>["a"] for map[string]T)
    v, err = a~>a
    assert(err == nil, "unexpected error")

    f := func () error {
        a~>a = "xxxxx"
        var x string
        x = a~>a?
        assert(x == "xxxxx", "dyn set get error")
        return nil
    }
    
    f()
    
    // Type assert to error
    e, ok := v.(error)
    assert(ok, "type assertion to error failed")
    assert(e != nil, "error is nil")
    assert(e.Error() == "err_a", "error message mismatch")
    
    println("PASS")
}

// Expected output:
// PASS
