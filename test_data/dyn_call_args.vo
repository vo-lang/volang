// Test dynamic method calls with arguments
// Tests: a~>method(args) syntax

package main

type Calculator struct {
	value int
}

func (c *Calculator) Add(x int) int {
	c.value = c.value + x
	return c.value
}

func (c *Calculator) AddTwo(x, y int) int {
	c.value = c.value + x + y
	return c.value
}

func (c *Calculator) Multiply(x int) int {
	c.value = c.value * x
	return c.value
}

func (c *Calculator) GetValue() int {
	return c.value
}

func (c *Calculator) Reset() {
	c.value = 0
}

type Greeter struct {
	prefix string
}

func (g *Greeter) Greet(name string) string {
	return g.prefix + name
}

func (g *Greeter) GreetTwo(first, second string) string {
	return g.prefix + first + " and " + second
}

func main() {
	// Test 1: Basic method call with one argument
	calc := &Calculator{value: 10}
	var obj interface{} = calc
	
	result, err := obj~>Add(5)
	if err != nil {
		println("Error:", err)
		return
	}
	val := result.(int)
	println("Add(5):", val) // expect: 15
	if val != 15 {
		println("FAIL: expected 15, got", val)
		return
	}
	
	// Test 2: Method call with two arguments
	result2, err2 := obj~>AddTwo(3, 7)
	if err2 != nil {
		println("Error:", err2)
		return
	}
	val2 := result2.(int)
	println("AddTwo(3, 7):", val2) // expect: 25 (15 + 3 + 7)
	if val2 != 25 {
		println("FAIL: expected 25, got", val2)
		return
	}
	
	// Test 3: Chain of method calls
	result3, err3 := obj~>Multiply(2)
	if err3 != nil {
		println("Error:", err3)
		return
	}
	val3 := result3.(int)
	println("Multiply(2):", val3) // expect: 50 (25 * 2)
	if val3 != 50 {
		println("FAIL: expected 50, got", val3)
		return
	}
	
	// Test 4: No-arg method call
	result4, err4 := obj~>GetValue()
	if err4 != nil {
		println("Error:", err4)
		return
	}
	val4 := result4.(int)
	println("GetValue():", val4) // expect: 50
	if val4 != 50 {
		println("FAIL: expected 50, got", val4)
		return
	}
	
	// Test 5: String method with argument
	greeter := &Greeter{prefix: "Hello, "}
	var strObj interface{} = greeter
	
	result5, err5 := strObj~>Greet("World")
	if err5 != nil {
		println("Error:", err5)
		return
	}
	str5 := result5.(string)
	println("Greet:", str5) // expect: "Hello, World"
	if str5 != "Hello, World" {
		println("FAIL: expected 'Hello, World', got", str5)
		return
	}
	
	// Test 6: String method with two arguments
	result6, err6 := strObj~>GreetTwo("Alice", "Bob")
	if err6 != nil {
		println("Error:", err6)
		return
	}
	str6 := result6.(string)
	println("GreetTwo:", str6) // expect: "Hello, Alice and Bob"
	if str6 != "Hello, Alice and Bob" {
		println("FAIL: expected 'Hello, Alice and Bob', got", str6)
		return
	}
	
	// Test 7: Method not found error
	_, errNotFound := obj~>NonExistent(1)
	if errNotFound == nil {
		println("FAIL: expected error for non-existent method")
		return
	}
	println("NonExistent error:", errNotFound)
	
	println("All tests passed!")
}
