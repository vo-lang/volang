// Test dynamic method calls with arguments
// Tests: a~>method(args) syntax

package main

type Calculator struct {
	value int
}

func (c *Calculator) Add(x int) int {
	c.value = c.value + x
	return c.value
}

func (c *Calculator) AddTwo(x, y int) int {
	c.value = c.value + x + y
	return c.value
}

func (c *Calculator) Multiply(x int) int {
	c.value = c.value * x
	return c.value
}

func (c *Calculator) GetValue() int {
	return c.value
}

func (c *Calculator) Reset() {
	c.value = 0
}

type Greeter struct {
	prefix string
}

func (g *Greeter) Greet(name string) string {
	return g.prefix + name
}

func (g *Greeter) GreetTwo(first, second string) string {
	return g.prefix + first + " and " + second
}

func main() {
	// Test 1: Basic method call with one argument
	calc := &Calculator{value: 10}
	var obj interface{} = calc
	
	result, err := obj~>Add(5)
	assert(err == nil, "Add error")
	val := result.(int)
	println("Add(5):", val) // expect: 15
	assert(val == 15, "expected 15")
	
	// Test 2: Method call with two arguments
	result2, err2 := obj~>AddTwo(3, 7)
	assert(err2 == nil, "AddTwo error")
	val2 := result2.(int)
	println("AddTwo(3, 7):", val2) // expect: 25 (15 + 3 + 7)
	assert(val2 == 25, "expected 25")
	
	// Test 3: Chain of method calls
	result3, err3 := obj~>Multiply(2)
	assert(err3 == nil, "Multiply error")
	val3 := result3.(int)
	println("Multiply(2):", val3) // expect: 50 (25 * 2)
	assert(val3 == 50, "expected 50")
	
	// Test 4: No-arg method call
	result4, err4 := obj~>GetValue()
	assert(err4 == nil, "GetValue error")
	val4 := result4.(int)
	println("GetValue():", val4) // expect: 50
	assert(val4 == 50, "expected 50")
	
	// Test 5: String method with argument
	greeter := &Greeter{prefix: "Hello, "}
	var strObj interface{} = greeter
	
	result5, err5 := strObj~>Greet("World")
	assert(err5 == nil, "Greet error")
	str5 := result5.(string)
	println("Greet:", str5) // expect: "Hello, World"
	assert(str5 == "Hello, World", "expected Hello, World")
	
	// Test 6: String method with two arguments
	result6, err6 := strObj~>GreetTwo("Alice", "Bob")
	assert(err6 == nil, "GreetTwo error")
	str6 := result6.(string)
	println("GreetTwo:", str6) // expect: "Hello, Alice and Bob"
	assert(str6 == "Hello, Alice and Bob", "expected Hello, Alice and Bob")
	
	// Test 7: Method not found error
	_, errNotFound := obj~>NonExistent(1)
	assert(errNotFound != nil, "expected error for non-existent method")
	println("NonExistent error:", errNotFound)
	
	println("All tests passed!")
}
