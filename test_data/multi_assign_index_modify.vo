// Test: multi-assignment where LHS index expressions are modified by other assignments
// Go spec: all LHS index expressions are evaluated before any assignment
package main

func main() {
    // Test 1: Index variable modified in same multi-assign
    arr := []int{10, 20, 30, 40, 50}
    i := 1
    // All LHS indices (arr[i] = arr[1]) evaluated BEFORE any assignment
    // Then assignments: arr[1]=100, i=3
    arr[i], i = 100, 3
    assert(arr[1] == 100, "arr[1] should be 100, got", arr[1])
    assert(i == 3, "i should be 3")
    assert(arr[3] == 40, "arr[3] should still be 40 (not modified)")
    
    // Test 2: Two array elements using same index variable
    arr2 := []int{1, 2, 3, 4, 5}
    j := 0
    // LHS: arr2[j]=arr2[0], arr2[j+1]=arr2[1]
    // Both evaluated before j changes
    arr2[j], arr2[j+1], j = 99, 88, 4
    assert(arr2[0] == 99, "arr2[0] should be 99")
    assert(arr2[1] == 88, "arr2[1] should be 88")
    assert(j == 4, "j should be 4")
    
    // Test 3: Map with key from variable being modified
    m := map[string]int{"a": 1, "b": 2, "c": 3}
    keys := []string{"a", "b", "c"}
    k := 0
    // LHS: m[keys[k]] = m["a"], evaluated before k changes
    m[keys[k]], k = 100, 2
    assert(m["a"] == 100, "m['a'] should be 100")
    assert(k == 2, "k should be 2")
    assert(m["c"] == 3, "m['c'] should still be 3")
    
    // Test 4: Nested index expressions
    matrix := [][]int{{1, 2}, {3, 4}, {5, 6}}
    row, col := 0, 1
    // LHS: matrix[row][col] = matrix[0][1]
    matrix[row][col], row, col = 999, 2, 0
    assert(matrix[0][1] == 999, "matrix[0][1] should be 999")
    assert(row == 2, "row should be 2")
    assert(col == 0, "col should be 0")
    assert(matrix[2][0] == 5, "matrix[2][0] should still be 5")
    
    // Test 5: Struct field with index
    type Item struct { vals []int }
    item := Item{vals: []int{10, 20, 30}}
    idx := 1
    item.vals[idx], idx = 200, 0
    assert(item.vals[1] == 200, "item.vals[1] should be 200")
    assert(idx == 0, "idx should be 0")
    
    println("multi_assign_index_modify: PASSED")
}
