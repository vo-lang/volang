// Test bidirectional port communication
package main

import "time"

func main() {
	i := make(island)
	reqPort := make(port int, 0)
	respPort := make(port int, 0)
	
	// Island receives request, sends response
	go @(i) func(req port int, resp port int) {
		for j := 0; j < 3; j++ {
			v := <-req
			println("island received:", v)
			resp <- v * 2
		}
	}(reqPort, respPort)
	
	// Main sends requests, receives responses
	for k := 1; k <= 3; k++ {
		reqPort <- k
		result := <-respPort
		println("main received:", result)
		assert(result == k*2, "expected k*2")
	}
	
	close(reqPort)
	close(respPort)
	println("PASS")
}
