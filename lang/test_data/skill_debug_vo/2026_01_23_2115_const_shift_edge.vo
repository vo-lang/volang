// Test: Const expressions with shift operations edge cases
package main

// Test 1: Basic const shifts
const (
	shift1 = 1 << 3      // 8
	shift2 = 16 >> 2     // 4
	shift3 = 1 << 10     // 1024
	shift4 = 0xFF >> 4   // 15
)

func testBasicConstShift() {
	assert(shift1 == 8, "1 << 3")
	assert(shift2 == 4, "16 >> 2")
	assert(shift3 == 1024, "1 << 10")
	assert(shift4 == 15, "0xFF >> 4")
}

// Test 2: Shift with typed consts
const (
	typedShift1 int   = 1 << 4    // 16
	typedShift2 int64 = 1 << 32   // 4294967296
	typedShift3 uint  = 1 << 8    // 256
)

func testTypedConstShift() {
	assert(typedShift1 == 16, "typed int shift")
	assert(typedShift2 == 4294967296, "typed int64 shift")
	assert(typedShift3 == 256, "typed uint shift")
}

// Test 3: Shift in const expression
const (
	base      = 1
	shifted   = base << 5           // 32
	combined  = (base << 3) | 0x0F  // 8 | 15 = 23... wait, 8 | 15 = 15
)

func testConstExprShift() {
	assert(shifted == 32, "shifted base")
	// 8 | 15 = 0b1000 | 0b1111 = 0b1111 = 15
	// Wait, that's wrong. 8 | 15 = 0b1000 | 0b1111 = 0b1111 = 15
	// No wait: 0b1000 | 0b1111 = 0b1111 = 15
	assert(combined == 15, "combined shift or")
}

// Test 4: Shift amount as const
const (
	amount   = 4
	shifted4 = 1 << amount  // 16
)

func testConstShiftAmount() {
	assert(shifted4 == 16, "const shift amount")
}

// Test 5: Negative shift result (right shift preserves sign for signed)
func testRightShiftSigned() {
	var x int = -16
	result := x >> 2
	assert(result == -4, "right shift signed")
	
	// Unsigned doesn't preserve sign
	var y uint64 = 0xFFFFFFFF_FFFFFFFF
	result2 := y >> 60
	assert(result2 == 0xF, "right shift unsigned")
}

// Test 6: Shift by zero
func testShiftByZero() {
	x := 42
	assert(x<<0 == 42, "left shift by 0")
	assert(x>>0 == 42, "right shift by 0")
}

// Test 7: Shift chain
func testShiftChain() {
	x := 1
	result := x << 4 >> 2 << 1
	// (1 << 4) = 16, (16 >> 2) = 4, (4 << 1) = 8
	assert(result == 8, "shift chain")
}

// Test 8: Shift with addition/subtraction
func testShiftWithArith() {
	x := 1
	result := (x << 3) + (x << 2)
	// 8 + 4 = 12
	assert(result == 12, "shift with add")
	
	result2 := (x << 4) - (x << 2)
	// 16 - 4 = 12
	assert(result2 == 12, "shift with sub")
}

// Test 9: Const iota with shift
const (
	Flag1 = 1 << iota  // 1
	Flag2              // 2
	Flag3              // 4
	Flag4              // 8
)

func testIotaShift() {
	assert(Flag1 == 1, "iota shift 0")
	assert(Flag2 == 2, "iota shift 1")
	assert(Flag3 == 4, "iota shift 2")
	assert(Flag4 == 8, "iota shift 3")
	
	combined := Flag1 | Flag3
	assert(combined == 5, "combined flags")
}

// Test 10: Large shift amounts (within bounds)
func testLargeShift() {
	var x int64 = 1
	result := x << 62
	expected := int64(1) << 62
	assert(result == expected, "large shift 62")
	
	var y uint64 = 1
	result2 := y << 63
	expected2 := uint64(1) << 63
	assert(result2 == expected2, "large shift 63")
}

// Test 11: Shift in if condition
func testShiftInCondition() {
	x := 4
	if x == (1 << 2) {
		// ok
	} else {
		panic("shift in condition failed")
	}
}

// Test 12: Shift result assigned to different types
func testShiftTypeAssign() {
	var i8 int8 = int8(1 << 6)      // 64
	var i16 int16 = int16(1 << 10)  // 1024
	var i32 int32 = int32(1 << 20)  // 1048576
	
	assert(i8 == 64, "shift to int8")
	assert(i16 == 1024, "shift to int16")
	assert(i32 == 1048576, "shift to int32")
}

// Test 13: Shift in switch case
func testShiftInSwitch() {
	x := 8
	result := ""
	switch x {
	case 1 << 0:
		result = "1"
	case 1 << 1:
		result = "2"
	case 1 << 2:
		result = "4"
	case 1 << 3:
		result = "8"
	}
	assert(result == "8", "shift in switch case")
}

// Test 14: Compound shift assignment
func testCompoundShiftAssign() {
	x := 4
	x <<= 2
	assert(x == 16, "compound left shift")
	
	x >>= 1
	assert(x == 8, "compound right shift")
}

// Test 15: Shift with variable amount
func testVariableShiftAmount() {
	x := 1
	for i := 0; i < 5; i++ {
		result := x << i
		expected := 1 << i
		assert(result == expected, "variable shift amount")
	}
}

func main() {
	testBasicConstShift()
	println("Test 1: PASSED - basic const shift")
	
	testTypedConstShift()
	println("Test 2: PASSED - typed const shift")
	
	testConstExprShift()
	println("Test 3: PASSED - const expr shift")
	
	testConstShiftAmount()
	println("Test 4: PASSED - const shift amount")
	
	testRightShiftSigned()
	println("Test 5: PASSED - right shift signed")
	
	testShiftByZero()
	println("Test 6: PASSED - shift by zero")
	
	testShiftChain()
	println("Test 7: PASSED - shift chain")
	
	testShiftWithArith()
	println("Test 8: PASSED - shift with arith")
	
	testIotaShift()
	println("Test 9: PASSED - iota shift")
	
	testLargeShift()
	println("Test 10: PASSED - large shift")
	
	testShiftInCondition()
	println("Test 11: PASSED - shift in condition")
	
	testShiftTypeAssign()
	println("Test 12: PASSED - shift type assign")
	
	testShiftInSwitch()
	println("Test 13: PASSED - shift in switch")
	
	testCompoundShiftAssign()
	println("Test 14: PASSED - compound shift assign")
	
	testVariableShiftAmount()
	println("Test 15: PASSED - variable shift amount")
	
	println("ALL PASSED")
}

func assert(cond bool, msg string) {
	if !cond {
		panic("assertion failed: " + msg)
	}
}
