package main


import "fmt"
type Point struct {
    x int
    y int
}

// 值接收者方法
func (p Point) Sum() int {
    return p.x + p.y
}

// 指针接收者方法
func (p *Point) Double() {
    p.x = p.x * 2
    p.y = p.y * 2
}

func main() {
    // Test 1: 不逃逸的 struct - 只调用值接收者方法
    p1 := Point{x: 10, y: 20}
    assert(p1.Sum() == 30)
    assert(p1.x == 10)  // Sum 不修改原值
    assert(p1.y == 20)
    fmt.Println("p1.Sum():", p1.Sum())

    // Test 2: 逃逸的 struct - 调用指针接收者方法
    p2 := Point{x: 100, y: 200}
    p2.Double()  // 导致 p2 逃逸，并修改原值
    assert(p2.x == 200)  // 100 * 2
    assert(p2.y == 400)  // 200 * 2
    assert(p2.Sum() == 600)
    fmt.Println("p2 after Double:", p2.Sum())

    // Test 3: 值语义 - p1 和 p2 独立
    assert(p1.x == 10)  // p1 未被 p2.Double 影响
    assert(p1.y == 20)

    fmt.Println("All tests passed!")
}
