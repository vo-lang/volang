package main

import (
	"bytes"
	"io"
	"strings"
)

func main() {
	testBytesReader()
	testStringsReader()
}

func testBytesReader() {
	data := []byte("hello world")
	r := bytes.NewReader(data)

	// Test Len and Size
	if r.Len() != 11 {
		panic("bytes.Reader: Len failed")
	}
	if r.Size() != 11 {
		panic("bytes.Reader: Size failed")
	}

	// Test Read
	buf := make([]byte, 5)
	n, err := r.Read(buf)
	if err != nil || n != 5 || string(buf) != "hello" {
		panic("bytes.Reader: Read failed")
	}

	// Test ReadByte
	b, err := r.ReadByte()
	if err != nil || b != ' ' {
		panic("bytes.Reader: ReadByte failed")
	}

	// Test UnreadByte
	err = r.UnreadByte()
	if err != nil {
		panic("bytes.Reader: UnreadByte failed")
	}
	b, _ = r.ReadByte()
	if b != ' ' {
		panic("bytes.Reader: UnreadByte did not work")
	}

	// Test Seek
	pos, err := r.Seek(0, io.SeekStart)
	if err != nil || pos != 0 {
		panic("bytes.Reader: Seek failed")
	}

	// Test ReadAt
	buf2 := make([]byte, 5)
	n, err = r.ReadAt(buf2, 6)
	if err != nil || n != 5 || string(buf2) != "world" {
		panic("bytes.Reader: ReadAt failed")
	}

	// Test Reset
	r.Reset([]byte("new"))
	if r.Len() != 3 {
		panic("bytes.Reader: Reset failed")
	}
}

func testStringsReader() {
	s := "hello world"
	r := strings.NewReader(s)

	// Test Len and Size
	if r.Len() != 11 {
		panic("strings.Reader: Len failed")
	}
	if r.Size() != 11 {
		panic("strings.Reader: Size failed")
	}

	// Test Read
	buf := make([]byte, 5)
	n, err := r.Read(buf)
	if err != nil || n != 5 || string(buf) != "hello" {
		panic("strings.Reader: Read failed")
	}

	// Test ReadByte
	b, err := r.ReadByte()
	if err != nil || b != ' ' {
		panic("strings.Reader: ReadByte failed")
	}

	// Test UnreadByte
	err = r.UnreadByte()
	if err != nil {
		panic("strings.Reader: UnreadByte failed")
	}
	b, _ = r.ReadByte()
	if b != ' ' {
		panic("strings.Reader: UnreadByte did not work")
	}

	// Test Seek
	pos, err := r.Seek(0, io.SeekStart)
	if err != nil || pos != 0 {
		panic("strings.Reader: Seek failed")
	}

	// Test ReadAt
	buf2 := make([]byte, 5)
	n, err = r.ReadAt(buf2, 6)
	if err != nil || n != 5 || string(buf2) != "world" {
		panic("strings.Reader: ReadAt failed")
	}

	// Test Reset
	r.Reset("new")
	if r.Len() != 3 {
		panic("strings.Reader: Reset failed")
	}
}
