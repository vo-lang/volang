// Regression test for ForLoop init variable corruption bug
// 
// Bug: When init expression is a variable (e.g., `for i := commonLen; ...`),
// the loop variable slot must be independent. Otherwise ForLoop modifies
// the original variable, corrupting subsequent loops using the same init.

package main

func main() {
	testMultipleLoopsSameInit()
	testLoopPreservesInitVar()
	testNestedLoopsWithSharedVar()
	testDecrementLoopPreservesInit()
	println("PASS")
}

// Two loops using same variable as init - the original bug case
func testMultipleLoopsSameInit() {
	commonLen := 2
	baseLen := 4
	targLen := 5
	
	// First loop: go up from commonLen to baseLen
	upCount := 0
	for i := commonLen; i < baseLen; i++ {
		upCount++
	}
	
	// Second loop: go down from commonLen to targLen
	// Bug: if first loop corrupted commonLen, this uses wrong init
	downCount := 0
	for i := commonLen; i < targLen; i++ {
		downCount++
	}
	
	// commonLen should still be 2
	if commonLen != 2 {
		panic("commonLen was corrupted")
	}
	if upCount != 2 {
		panic("upCount wrong")
	}
	if downCount != 3 {
		panic("downCount wrong")
	}
}

// Loop should not modify the init variable
func testLoopPreservesInitVar() {
	start := 5
	sum := 0
	for i := start; i < 10; i++ {
		sum += i
	}
	
	if start != 5 {
		panic("start was corrupted")
	}
	if sum != 35 { // 5+6+7+8+9
		panic("sum wrong")
	}
}

// Nested loops with shared init variable
func testNestedLoopsWithSharedVar() {
	limit := 3
	count := 0
	
	for i := 0; i < limit; i++ {
		for j := limit; j < 6; j++ {
			count++
		}
	}
	
	if limit != 3 {
		panic("limit was corrupted")
	}
	if count != 9 { // 3 outer * 3 inner
		panic("count wrong")
	}
}

// Decrement loop should not corrupt init var
func testDecrementLoopPreservesInit() {
	high := 5
	sum := 0
	for i := high; i > 0; i-- {
		sum += i
	}
	
	if high != 5 {
		panic("high was corrupted")
	}
	if sum != 15 { // 5+4+3+2+1
		panic("sum wrong")
	}
	
	// Use high again
	sum2 := 0
	for i := high; i >= 3; i-- {
		sum2 += i
	}
	
	if high != 5 {
		panic("high was corrupted after second loop")
	}
	if sum2 != 12 { // 5+4+3
		panic("sum2 wrong")
	}
}
