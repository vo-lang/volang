// Test GC with map operations under stress
// Map key/value may contain GcRefs

package main


import "fmt"
func main() {
	// Test 1: Map with int keys and slice values
	m := make(map[int][]int)
	for i := 0; i < 100; i++ {
		m[i] = []int{i, i * 2, i * 3}
	}
	assert(len(m) == 100)
	assert(m[50][1] == 100)

	// Test 2: Map with struct values
	type Point struct {
		X, Y int
	}
	points := make(map[int]Point)
	for i := 0; i < 50; i++ {
		points[i] = Point{X: i, Y: i * 2}
	}
	assert(points[25].Y == 50)

	// Test 3: Delete and re-add (GC pressure)
	for i := 0; i < 50; i++ {
		delete(m, i)
	}
	assert(len(m) == 50)

	for i := 100; i < 150; i++ {
		m[i] = []int{i}
	}
	assert(len(m) == 100)

	// Test 4: Map of maps
	nested := make(map[int]map[int]int)
	for i := 0; i < 20; i++ {
		inner := make(map[int]int)
		for j := 0; j < 10; j++ {
			inner[j] = i * 10 + j
		}
		nested[i] = inner
	}
	assert(nested[5][3] == 53)

	fmt.Println("gc_map_stress: PASSED")
}
